<!DOCTYPE html><html lang="en" style="background:#eee" id="html"><head><meta charset="UTF-8"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><title>爆款促销</title><link rel="stylesheet" href="./css/main.css"><style>[v-cloak]{display:none}</style></head><body style="background:#eee"><section class="act_wraper" id="temBox" v-cloak><div class="guide_hint_w"><div class="guide_hint"><span class="guide_hint_icon"><img src="./images/icon_hint.png" alt=""></span><p class="guide_hint_text">第三步：请填写发布商品的详细情况</p><span class="guide_hint_close"><img src="images/icon_close.png" alt=""></span></div></div><div v-show="!edit.goodsView"><div class="flow_path"><div class="flow_path_img"><img src="./images/flow3.png"></div><div class="flow_path_text"><p>类型选择</p><p>选择模板</p><p>活动内容</p><p>活动设置</p></div></div><div class="act_name_input"><input class="actName" type="text" placeholder="活动名称" v-model="goods.name" maxlength="20" @input="" @focus="focusFooter" @blur="blurFooter"><p><span id="name_input_num" v-html="textNumber(goods.name)">0</span>/20</p></div><div class="act_des act_des2"><h4>活动描述（非必填）<span class="act_des_num"><span v-html="textNumber(goods.content.describe)"></span>/200</span></h4><textarea class="act_des_con" placeholder="您可填写宣传内容、优惠信息、企业介绍等内容" v-model="goods.content.describe" maxlength="200" @focus="focusFooter" @blur="blurFooter"></textarea></div><ul class="goods_list"><li v-for="(list,index) in goods.content.list" class="b_goods_recommend" :data-num="index"><div class="b_goods_recommend_b b_goods_recommend_b2"><div class="b_goods_recommend_d" @click="editGoods(index)"><div class="b_goods_recommend_l"><img :src="list.goodsImg?list.goodsImg:'images/goods_default.jpg'"></div><div class="b_goods_recommend_r"><p class="b_goods_title">{{list.goodsName?list.goodsName:"商品名称"}}</p><p class="b_goods_describe">{{list.goodsDescribe?list.goodsDescribe:"商品描述"}}</p><p class="b_goods_contact">联系商家</p></div><div v-show="!list.goodsName" class="shade_lucency"><p><img src="images/shou.png">商品信息(必填)<span>点击填写</span></p></div></div></div><div class="b_goods_menu"><span class="b_goods_del" v-show="onlyOne(index)" @click="delGoods(index)"><b><img src="images/del.png"></b>删除</span> <span class="b_goods_edit" v-show="list.goodsName" @click="editGoods(index)"><b><img src="images/icon_edit.png"></b>编辑</span></div></li></ul><div class="add_goods_btn" @click="addGoods"><span><img src="./images/add1.png" alt=""></span>继续添加商品</div><div class="goods_footer_wraper"><div class="goods_footer" id="goods_footer"><p class="preview" @click="preview"><span><img src="./images/eye.png"></span>&nbsp;&nbsp;预览效果</p><p class="next" @click="next">下一步</p></div></div></div><div v-show="edit.goodsShow" class="fillout_goods_w" @click="falseGoods"></div><transition name="slide-fade"><div v-show="edit.goodsShow" class="fillout_goods fillout_goods2" :data-num="edit.goodsNumEdit"><div class="fillout_goods_top"><p>编辑商品</p><span @click="falseGoods"><img src="./images/icon_close.png"></span></div><div class="fillout_goods_h"><div class="update_goods_i"><div class="unify_border update_goods_img"><form class="imgFile"><label @click="updateImage"><img v-if="edit.goodsImgEdit" class="update_img_show" :src="edit.goodsImgEdit" alt=""><div v-else><h5 class="img_title">宣传图</h5><img class="hand" src="images/hand.png" alt=""><p class="img_con">点击上传1张图片</p></div></label> <span v-if="edit.goodsImgEdit" class="del_img" @click="delImg"><img src="./images/close.png" alt=""></span></form></div></div><div class="act_name_input"><input class="actName" type="text" placeholder="商品名称" v-model="edit.goodsNameEdit" maxlength="12"><p><span id="" v-html="goodsNameShow">0</span>/12</p></div><div class="act_name_input"><input class="actName" type="text" placeholder="描述（商品折扣或价格或特点）" v-model="edit.goodsDescribeEdit" maxlength="12"><p><span id="" v-html="goodsDescribeShow">0</span>/12</p></div></div><div class="goods_footer_wraper"><div class="goods_footer goods_footer2" id="switchover"><p class="preview" @click="falseGoods">取消</p><p class="next" @click="trueGoods">确定</p></div></div></div></transition></section><script src="./js/jquery-1.11.3.min.js"></script><script src="./js/alert.js"></script><script src="./js/main.js?v=2"></script><script src="../../common/js/source/vue.min.js"></script><script src="./js/szad.js"></script><script>var app=new Vue({el:"#temBox",data:{goods:{name:"",content:{describe:"",list:[{goodsName:"",goodsImg:"",goodsDescribe:""},{goodsName:"",goodsImg:"",goodsDescribe:""}]}},edit:{goodsShow:!1,goodsView:!1,goodsNumEdit:"",goodsNameEdit:"",goodsDescribeEdit:"",goodsImgEdit:""}},created:function(){var t=packaging.GetQueryString("editid"),o=packaging.GetQueryString("copy"),i=window.sessionStorage;return t||o||i.goodList||window.actCommon.addStep("step3",localStorage.step3),i.goodList?(this.goods=JSON.parse(i.goodList),!1):t?(this.editActivity(t),!1):void(o&&this.copyActivity(o))},mounted:function(){var t=document.getElementById("switchover");t.style.top=window.innerHeight-60+"px",t.style.bottom="auto",actCommon.footerFixed()},computed:{goodsNumShow:function(){return this.goods.name.length},goodsNameShow:function(){return this.edit.goodsNameEdit.length},goodsDescribeShow:function(){return this.edit.goodsDescribeEdit.length}},methods:{editActivity:function(e){packaging.loading("加载中..."),szad.init();var s=this;szad.getUserInfo(function(t){t=actCommon.transformJson(t);var o={advertiseId:parseInt(e),userId:t.garageId,account:t.account},i=actCommon.appApiW()+"/api/app/advertise/sale/advertise/details";szad.requestNetworkData(i,o,function(t){if(packaging.loadingRemove(),(t=actCommon.transformJson(t)).success){s.goods.name=t.info.name,s.goods.content=JSON.parse(t.info.content),s.goods.posterPic=t.info.posterPic,s.goods.startTime=t.info.startTime,s.goods.endTime=t.info.endTime;for(var o=t.info.cityInfo[0].cityCode,i=t.info.cityInfo,e=1;e<i.length;e++){if("000000"==i[e].cityCode||0==i[e].cityCode){o="000000";break}o+=","+i[e].cityCode}s.goods.cityCode=o}else packaging.fubottom(t.message)})})},copyActivity:function(e){packaging.loading("加载中..."),szad.init();var s=this;szad.getUserInfo(function(t){t=actCommon.transformJson(t);var o={advertiseId:parseInt(e),userId:t.garageId,account:t.account},i=actCommon.appApiW()+"/api/app/advertise/sale/advertise/details";szad.requestNetworkData(i,o,function(t){if(packaging.loadingRemove(),(t=actCommon.transformJson(t)).success){s.goods.name=t.info.name,s.goods.content=JSON.parse(t.info.content),s.goods.templateId=t.info.templateId,s.goods.advertiseClassifyId=t.info.advertiseClassifyId,s.goods.posterPic=t.info.posterPic;for(var o=t.info.cityInfo[0].cityCode,i=t.info.cityInfo,e=1;e<i.length;e++){if("000000"==i[e].cityCode||0==i[e].cityCode){o="000000";break}o+=","+i[e].cityCode}s.goods.cityCode=o}else packaging.fubottom(t.message)})})},addGoods:function(){if(this.goods.content.list.length<12){this.goods.content.list.push({goodsName:"",goodsImg:"",goodsDescribe:""}),setTimeout(function(){var t=packaging.getScrollHeight();window.scrollTo(0,t)},100)}else $.myAlert("最多只能添加12个商品")},editGoods:function(t){this.edit.goodsShow=!0;var o=this.goods.content.list[t];o.goodsName?(this.edit.goodsNumEdit=t,this.edit.goodsImgEdit=o.goodsImg,this.edit.goodsNameEdit=o.goodsName,this.edit.goodsDescribeEdit=o.goodsDescribe):(this.edit.goodsNumEdit=t,this.edit.goodsImgEdit="",this.edit.goodsNameEdit="",this.edit.goodsDescribeEdit=""),window.ModalHelper.afterOpen()},updateImage:function(){szad.init();var o=this;szad.cutImage({judgeCut:!0,width:200,height:200,widthScale:1,heightScale:1},function(t){(t=actCommon.transformJson(t)).success?o.edit.goodsImgEdit=t.info.domain+t.info.filePath:packaging.fubottom(t.message)})},trueGoods:function(){var t=this.edit.goodsNumEdit,o=this.goods.content.list[t],i=this.edit.goodsImgEdit,e=this.edit.goodsNameEdit,s=this.edit.goodsDescribeEdit;this.edit.goodsOldPriceEdit,this.edit.goodsNewPriceEdit;return i?e?actCommon.isSpecific(e)?(packaging.fubottom("商品名称不允许输入特殊符号"),!1):e.length<2?(packaging.fubottom("商品名称最少输入2个字"),!1):s?actCommon.isSpecific(s)?(packaging.fubottom("商品描述不允许输入特殊符号"),!1):(o.goodsImg=i,o.goodsName=e,o.goodsDescribe=s,this.edit.goodsShow=!1,this.edit.goodsNumEdit="",this.edit.goodsImgEdit="",this.edit.goodsNameEdit="",this.edit.goodsDescribeEdit="",void window.ModalHelper.beforeClose()):(packaging.fubottom("商品描述不能为空"),!1):(packaging.fubottom("请输入商品名称"),!1):(packaging.fubottom("请上传图片"),!1)},falseGoods:function(){this.edit.goodsShow=!1,this.edit.goodsNumEdit="",this.edit.goodsImgEdit="",this.edit.goodsNameEdit="",this.edit.goodsDescribeEdit="",window.ModalHelper.beforeClose()},delGoods:function(t){if(2<this.goods.content.list.length){var o=this;$.myConfirmZ({title:"确定要删除吗？",trueBtn:"确定",falseBtn:"我再想想",message:"删除后，您填写的信息将被删除",callback:function(){o.goods.content.list.splice(t,1),packaging.fubottom("删除成功")}})}else $.myAlert("至少要保留2个商品哦~")},preview:function(){if(this.judge()){this.setInfo("goodList",JSON.stringify(this.goods));window.sessionStorage;window.location.href="preview2.html"}},next:function(){if(this.judge()){this.setInfo("goodList",JSON.stringify(this.goods));var t=packaging.GetQueryString("editid");if(t)return window.location.href="setting.html?editid="+t,!1;var o=packaging.GetQueryString("copy");if(o){var i=this.goods.templateId,e=this.goods.advertiseClassifyId;return window.location.href="setting.html?copy="+o+"&classify="+e+"&plate="+i,!1}e=packaging.GetQueryString("classify"),i=packaging.GetQueryString("plate");e&&i&&(window.location.href="setting.html?classify="+e+"&plate="+i)}},judge:function(){var t=this.goods.content.list;if(!this.goods.name)return $.myAlert("请填写活动标题"),!1;if(this.goods.name.length<2)return $.myAlert("活动标题最少输入2个字"),!1;if(actCommon.isSpecific(this.goods.name))return $.myAlert("活动标题禁止输入特殊符号"),!1;if(actCommon.isSpecific(this.goods.content.describe))return $.myAlert("活动描述禁止输入特殊符号"),!1;for(var o=0;o<t.length;o++)if(!t[o].goodsName||!t[o].goodsImg||!t[o].goodsDescribe)return $.myAlert("第"+(o+1)+"个商品信息还没填写完整哦~"),!1;return!0},setInfo:function(t,o){window.sessionStorage.setItem(t,o)},huanhang:function(t){if(!t)return"";for(var o=(t=t.toString()).split("\n"),i="",e=0;e<o.length;e++)i+="<p>"+o[e]+"</p>";return i},textNumber:function(t){return t?t.length:0},titleverify:function(t){if(!t)return"";return(t=t.toString()).replace(/^\s*$/g,"")},onlyOne:function(t){return!(this.goods.content.list.length<=2)},delImg:function(){this.edit.goodsImgEdit=""},focusFooter:function(){/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)&&(document.getElementById("goods_footer").style.position="static")},blurFooter:function(){/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)&&(document.getElementById("goods_footer").style.position="fixed")}}})</script><script>!function(){var t=Math.floor(1e6*Math.random()),e=document.createElement("script");e.setAttribute("type","text/javascript"),e.src="../../common/js/tencent.js?rnd="+t;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(e,r)}()</script></body></html>