<!DOCTYPE html><html lang="en" style="background:#eee" id="html"><head><meta charset="UTF-8"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><title>超值买赠</title><link rel="stylesheet" href="./css/main.css"><style>[v-cloak]{display:none}</style></head><body style="background:#eee"><section class="act_wraper" id="temBox" v-cloak><div class="guide_hint_w"><div class="guide_hint"><span class="guide_hint_icon"><img src="./images/icon_hint.png" alt=""></span><p class="guide_hint_text">第三步：请填写发布商品的详细情况</p><span class="guide_hint_close"><img src="images/icon_close.png" alt=""></span></div></div><div v-show="!edit.goodsView"><div class="flow_path"><div class="flow_path_img"><img src="./images/flow3.png"></div><div class="flow_path_text"><p>类型选择</p><p>选择模板</p><p>活动内容</p><p>活动设置</p></div></div><div class="act_name_input"><input class="actName" type="text" placeholder="活动名称" v-model="goods.name" maxlength="20" @input="" @focus="focusFooter" @blur="blurFooter"><p><span id="name_input_num" v-html="goodsNumShow">0</span>/20</p></div><ul class="overflow_w"><li class="goods_list goods_list2" v-for="(list,index) in goods.content.list" :data-num="index"><div class="overflow_li overflow_li2" @click="editGoods(index)"><div class="overflow_l"><img :src="list.goodsImg?list.goodsImg:'images/goods_default.jpg'"></div><div class="overflow_r"><p class="overflow_list dian">{{list.goodsName?list.goodsName:"商品名称"}}</p><p class="overflow_des dian">{{list.goodsDescribe?list.goodsDescribe:"商品描述"}}</p><div class="overflow_zeng overflow_zeng2"><div class="overflow_zeng_l"><p class="overflow_zeng_title">买即赠</p><p class="overflow_zeng_des twodian">{{list.goodsDescribeGive?list.goodsDescribeGive:"赠品描述"}}</p></div><div class="overflow_zeng_r"><img :src="list.goodsImgGive?list.goodsImgGive:'images/goods_default.jpg'"></div></div></div><div v-show="!list.goodsName" class="shade_lucency"><p><img src="images/shou.png"> 商品信息(必填)<span>点击填写</span></p></div></div><div class="b_goods_menu"><span class="b_goods_del" v-show="onlyOne(index)" @click="delGoods(index)"><b><img src="images/del.png"></b>删除</span> <span class="b_goods_edit" v-show="list.goodsName" @click="editGoods(index)"><b><img src="images/icon_edit.png"></b>编辑</span></div></li></ul><div class="add_goods_btn" @click="addGoods"><span><img src="./images/add1.png" alt=""></span>继续添加商品</div><div class="goods_footer_wraper"><div class="goods_footer" id="goods_footer"><p class="preview" @click="preview"><span><img src="./images/eye.png"></span>&nbsp;&nbsp;预览效果</p><p class="next" @click="next">下一步</p></div></div></div><div v-show="edit.goodsShow" class="fillout_goods_w" @click="falseGoods"></div><transition name="slide-fade"><div v-show="edit.goodsShow" class="fillout_goods fillout_goods2" :data-num="edit.goodsNumEdit"><div class="fillout_goods_top"><p>编辑商品</p><span @click="falseGoods"><img src="./images/icon_close.png"></span></div><div class="fillout_goods_h"><div class="update_goods_i"><div class="unify_border update_goods_img"><form class="imgFile"><label @click="updateImage('1')"><img v-if="edit.goodsImgEdit" class="update_img_show" :src="edit.goodsImgEdit" alt=""><div v-else><h5 class="img_title">商品图(必填)</h5><img class="hand" src="images/hand.png" alt=""><p class="img_con">点击上传1张图片</p></div></label> <span v-if="edit.goodsImgEdit" class="del_img" @click="delImg('1')"><img src="./images/close.png" alt=""></span></form></div></div><div class="act_name_input"><input class="actName" type="text" placeholder="商品名称" v-model="edit.goodsNameEdit" maxlength="12"><p><span id="name_input_num" v-html="goodsNameShow">0</span>/12</p></div><div class="act_name_input"><input class="actName" type="text" placeholder="描述（商品折扣或价格或特点）" v-model="edit.goodsDescribeEdit" maxlength="12"><p><span id="name_input_num" v-html="goodsDescribeShow">0</span>/12</p></div><div class="complimentary_tit">赠品信息</div><div class="update_goods_i update_goods_i2"><div class="unify_border update_goods_img"><form class="imgFile"><label @click="updateImage('2')"><img v-if="edit.goodsImgGiveEdit" class="update_img_show" :src="edit.goodsImgGiveEdit" alt=""><div v-else><h5 class="img_title">赠送商品图</h5><img class="hand" src="images/hand.png" alt=""><p class="img_con">点击上传</p></div></label> <span v-if="edit.goodsImgGiveEdit" class="del_img" @click="delImg('2')"><img src="./images/close.png" alt=""></span></form></div></div><div class="act_name_input"><input class="actName" type="text" placeholder="描述：赠品描述" v-model="edit.goodsDescribeGiveEdit" maxlength="12"><p><span id="name_input_num" v-html="goodsDescribeGiveShow">0</span>/12</p></div><div class="goods_footer_wraper"><div class="goods_footer goods_footer2" id="switchover"><p class="preview" @click="falseGoods">取消</p><p class="next" @click="trueGoods">确定</p></div></div></div></div></transition></section><script src="./js/jquery-1.11.3.min.js"></script><script src="./js/alert.js"></script><script src="../../common/js/source/vue.min.js"></script><script src="./js/szad.js"></script><script src="./js/main.js?v=1"></script><script>var app=new Vue({el:"#temBox",data:{goods:{name:"",content:{list:[{goodsName:"",goodsImg:"",goodsDescribe:"",goodsImgGive:"",goodsDescribeGive:""},{goodsName:"",goodsImg:"",goodsDescribe:"",goodsImgGive:"",goodsDescribeGive:""}]}},edit:{goodsShow:!1,goodsView:!1,goodsNumEdit:"",goodsNameEdit:"",goodsImgEdit:"",goodsDescribeEdit:"",goodsImgGiveEdit:"",goodsDescribeGiveEdit:""}},created:function(){var o=packaging.GetQueryString("editid"),t=packaging.GetQueryString("copy"),i=window.sessionStorage;return o||t||i.goodList||window.actCommon.addStep("step3",localStorage.step3),i.goodList?(this.goods=JSON.parse(i.goodList),!1):o?(this.editActivity(o),!1):void(t&&this.copyActivity(t))},computed:{goodsNumShow:function(){return this.goods.name?this.goods.name.length:0},goodsNameShow:function(){return this.edit.goodsNameEdit?this.edit.goodsNameEdit.length:0},goodsDescribeShow:function(){return this.edit.goodsDescribeEdit?this.edit.goodsDescribeEdit.length:0},goodsDescribeGiveShow:function(){return this.edit.goodsDescribeGiveEdit?this.edit.goodsDescribeGiveEdit.length:0}},mounted:function(){var o=document.getElementById("switchover");o.style.top=window.innerHeight-60+"px",o.style.bottom="auto",actCommon.footerFixed()},methods:{editActivity:function(e){packaging.loading("加载中..."),szad.init();var s=this;szad.getUserInfo(function(o){o=actCommon.transformJson(o);var t={advertiseId:parseInt(e),userId:o.garageId,account:o.account},i=actCommon.appApiW()+"/api/app/advertise/sale/advertise/details";szad.requestNetworkData(i,t,function(o){if(packaging.loadingRemove(),(o=actCommon.transformJson(o)).success){s.goods.name=o.info.name,s.goods.content=JSON.parse(o.info.content),s.goods.posterPic=o.info.posterPic,s.goods.startTime=o.info.startTime,s.goods.endTime=o.info.endTime;for(var t=o.info.cityInfo[0].cityCode,i=o.info.cityInfo,e=1;e<i.length;e++)t+=","+i[e].cityCode;s.goods.cityCode=t}else packaging.fubottom(o.message)})})},copyActivity:function(e){packaging.loading("加载中..."),szad.init();var s=this;szad.getUserInfo(function(o){o=actCommon.transformJson(o);var t={advertiseId:parseInt(e),userId:o.garageId,account:o.account},i=actCommon.appApiW()+"/api/app/advertise/sale/advertise/details";szad.requestNetworkData(i,t,function(o){if(packaging.loadingRemove(),(o=actCommon.transformJson(o)).success){s.goods.name=o.info.name,s.goods.content=JSON.parse(o.info.content),s.goods.templateId=o.info.templateId,s.goods.advertiseClassifyId=o.info.advertiseClassifyId,s.goods.posterPic=o.info.posterPic;for(var t=o.info.cityInfo[0].cityCode,i=o.info.cityInfo,e=1;e<i.length;e++){if("000000"==i[e].cityCode||0==i[e].cityCode){t="000000";break}t+=","+i[e].cityCode}s.goods.cityCode=t}else packaging.fubottom(o.message)})})},addGoods:function(){if(this.goods.content.list.length<12){this.goods.content.list.push({goodsName:"",goodsImg:"",goodsDescribe:""}),setTimeout(function(){var o=packaging.getScrollHeight();window.scrollTo(0,o)},100)}else $.myAlert("最多只能添加12个商品")},editGoods:function(o){this.edit.goodsShow=!0;var t=this.goods.content.list[o];t.goodsName?(this.edit.goodsNumEdit=o,this.edit.goodsImgEdit=t.goodsImg,this.edit.goodsNameEdit=t.goodsName,this.edit.goodsDescribeEdit=t.goodsDescribe,this.edit.goodsImgGiveEdit=t.goodsImgGive,this.edit.goodsDescribeGiveEdit=t.goodsDescribeGive):(this.edit.goodsNumEdit=o,this.edit.goodsImgEdit="",this.edit.goodsNameEdit="",this.edit.goodsDescribeEdit="",this.edit.goodsImgGiveEdit="",this.edit.goodsDescribeGiveEdit=""),window.ModalHelper.afterOpen()},updateImage:function(i){szad.init();var e=this;szad.cutImage({judgeCut:!0,width:200,height:200,widthScale:1,heightScale:1},function(o){if((o=actCommon.transformJson(o)).success){var t=o.info.domain+o.info.filePath;"1"==i&&(e.edit.goodsImgEdit=t),"2"==i&&(e.edit.goodsImgGiveEdit=t)}else packaging.fubottom(o.message)})},trueGoods:function(){var o=this.edit.goodsNumEdit,t=this.goods.content.list[o],i=this.edit.goodsImgEdit,e=this.edit.goodsNameEdit,s=this.edit.goodsDescribeEdit,d=this.edit.goodsImgGiveEdit,n=this.edit.goodsDescribeGiveEdit;return i?e?e.length<2?(packaging.fubottom("商品名称最少输入2个字"),!1):actCommon.isSpecific(e)?(packaging.fubottom("商品名称不允许输入特殊符号"),!1):s?actCommon.isSpecific(s)?(packaging.fubottom("商品描述不允许输入特殊符号"),!1):d?n?actCommon.isSpecific(n)?(packaging.fubottom("赠品描述不允许输入特殊符号"),!1):(t.goodsImg=i,t.goodsName=e,t.goodsDescribe=s,t.goodsImgGive=d,t.goodsDescribeGive=n,this.edit.goodsShow=!1,this.edit.goodsNumEdit="",this.edit.goodsImgEdit="",this.edit.goodsNameEdit="",this.edit.goodsDescribeEdit="",this.edit.goodsImgGiveEdit="",this.edit.goodsDescribeGiveEdit="",void window.ModalHelper.beforeClose()):(packaging.fubottom("赠品描述不能为空"),!1):(packaging.fubottom("赠品图片不能为空"),!1):(packaging.fubottom("商品描述不能为空"),!1):(packaging.fubottom("商品名称不能为空"),!1):(packaging.fubottom("请上传图片"),!1)},falseGoods:function(){this.edit.goodsShow=!1,this.edit.goodsNumEdit="",this.edit.goodsImgEdit="",this.edit.goodsNameEdit="",this.edit.goodsDescribeEdit="",this.edit.goodsImgGiveEdit="",this.edit.goodsDescribeGiveEdit="",window.ModalHelper.beforeClose()},delGoods:function(o){if(2<this.goods.content.list.length){var t=this;$.myConfirmZ({title:"确定要删除吗？",trueBtn:"确定",falseBtn:"我再想想",message:"删除后，您填写的信息将被删除",callback:function(){t.goods.content.list.splice(o,1),packaging.fubottom("删除成功")}})}else $.myAlert("至少要保留2个商品哦~")},preview:function(){this.judge()&&(this.setInfo("goodList",JSON.stringify(this.goods)),window.location.href="preview3.html")},next:function(){if(this.judge()){this.setInfo("goodList",JSON.stringify(this.goods));var o=packaging.GetQueryString("editid");if(o)return window.location.href="setting.html?editid="+o,!1;var t=packaging.GetQueryString("copy");if(t){var i=this.goods.templateId,e=this.goods.advertiseClassifyId;return window.location.href="setting.html?copy="+t+"&classify="+e+"&plate="+i,!1}e=packaging.GetQueryString("classify"),i=packaging.GetQueryString("plate");e&&i&&(window.location.href="setting.html?classify="+e+"&plate="+i)}},judge:function(){var o=this.goods.content.list;if(!this.goods.name)return $.myAlert("请填写活动标题"),!1;if(this.goods.name.length<2)return $.myAlert("活动标题最少输入2个字"),!1;if(actCommon.isSpecific(this.goods.name))return $.myAlert("活动标题禁止输入特殊符号"),!1;if(this.goods.name<2)return $.myAlert("活动标题最少输入2个字"),!1;for(var t=0;t<o.length;t++)if(!(o[t].goodsName&&o[t].goodsImg&&o[t].goodsDescribe&&o[t].goodsImgGive&&o[t].goodsDescribeGive))return $.myAlert("第"+(t+1)+"个商品信息还没填写完整哦~"),!1;return!0},setInfo:function(o,t){window.sessionStorage.setItem(o,t)},titleverify:function(o){if(!o)return"";return(o=o.toString()).replace(/^\s*$/g,"")},onlyOne:function(o){return!(this.goods.content.list.length<=2)},delImg:function(o){"1"==o?this.edit.goodsImgEdit="":this.edit.goodsImgGiveEdit=""},focusFooter:function(){/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)&&(document.getElementById("goods_footer").style.position="static")},blurFooter:function(){/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)&&(document.getElementById("goods_footer").style.position="fixed")}}})</script><script>!function(){var t=Math.floor(1e6*Math.random()),e=document.createElement("script");e.setAttribute("type","text/javascript"),e.src="../../common/js/tencent.js?rnd="+t;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(e,r)}()</script></body></html>