<!DOCTYPE html><html lang="en" style="background:#eee"><head><meta charset="UTF-8"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><title>简版</title><link rel="stylesheet" href="./css/main.css"><style>[v-cloak]{display:none}</style></head><body style="background:#eee"><section class="act_wraper" id="temBox" v-cloak><div class="guide_hint_w"><div class="guide_hint"><span class="guide_hint_icon"><img src="./images/icon_hint.png" alt=""></span><p class="guide_hint_text">第三步：请填写发布商品的详细情况</p><span class="guide_hint_close" onclick="actCommon.upHint()"><img src="images/icon_close.png" alt=""></span></div></div><div v-show="!edit.goodsShow && !edit.goodsView"><div class="flow_path"><div class="flow_path_img"><img src="./images/flow3.png"></div><div class="flow_path_text"><p>类型选择</p><p>选择模板</p><p>活动内容</p><p>活动设置</p></div></div><div class="act_name_input act_name_input2"><input class="actName" type="text" placeholder="活动名称" v-model="goods.name" maxlength="20" @input="" @focus="focusFooter" @blur="blurFooter"><p><span id="name_input_num" v-html="goodsNumShow">0</span>/20</p></div><ul class="goods_list"><li v-for="(list,index) in goods.content.list" class="b_goods_recommend" :data-num="index"><div class="unify_border update_goods_img update_goods_img2"><label @click="updateImage(index)"><img v-if="list.goodsImg" class="update_img_show" :src="list.goodsImg?list.goodsImg:'images/banner.jpg'" alt=""><div v-else><h5 class="img_title">宣传图（平铺、尺寸不限制）</h5><img class="hand" src="images/hand.png" alt=""><p class="img_con">点击上传1张图片</p></div></label> <span v-if="list.goodsImg" class="del_img" @click="delImg(index)"><img src="./images/close.png" height="31" width="31" alt=""></span></div><div class="act_des"><h4>活动描述（必填）<span class="act_des_num"><span v-html="textNumber(list.goodsDescribe)"></span>/2000</span></h4><textarea class="act_des_con" placeholder="您可填写宣传内容、优惠信息、企业介绍等内容" v-model="list.goodsDescribe" maxlength="2000" @focus="focusFooter" @blur="blurFooter"></textarea></div><div class="b_goods_menu"><span class="b_goods_del" v-show="onlyOne(index)" @click="delGoods(index)"><b><img src="images/del.png"></b>删除</span></div></li></ul><div class="add_goods_btn" @click="addGoods"><span><img src="./images/add1.png" alt=""></span>继续添加</div><div class="goods_footer_wraper"><div class="goods_footer" id="goods_footer"><p class="preview" @click="preview"><span><img src="./images/eye.png"></span>&nbsp;&nbsp;预览效果</p><p class="next" @click="next">下一步</p></div></div></div></section><script src="./js/jquery-1.11.3.min.js"></script><script src="./js/alert.js"></script><script src="../../common/js/source/vue.min.js"></script><script src="./js/szad.js"></script><script src="./js/main.js?v=3"></script><script>var app=new Vue({el:"#temBox",data:{goods:{name:"",content:{list:[{goodsImg:"",goodsDescribe:""}]}},edit:{goodsView:!1}},created:function(){var t=packaging.GetQueryString("editid"),o=packaging.GetQueryString("copy"),e=window.sessionStorage;return t||o||e.goodList||window.actCommon.addStep("step3",localStorage.step3),e.goodList?(this.goods=JSON.parse(e.goodList),!1):t?(packaging.loading("加载中..."),this.editActivity(t),!1):void(o&&(packaging.loading("加载中..."),this.copyActivity(o)))},mounted:function(){actCommon.footerFixed()},computed:{goodsNumShow:function(){return this.goods.name.length}},methods:{editActivity:function(i){szad.init();var n=this;szad.getUserInfo(function(t){t=actCommon.transformJson(t);var o={advertiseId:parseInt(i),userId:t.garageId,account:t.account},e=actCommon.appApiW()+"/api/app/advertise/sale/advertise/details";szad.requestNetworkData(e,o,function(t){if(packaging.loadingRemove(),(t=actCommon.transformJson(t)).success){n.goods.name=t.info.name,n.goods.content=JSON.parse(t.info.content),n.goods.posterPic=t.info.posterPic,n.goods.startTime=t.info.startTime,n.goods.endTime=t.info.endTime;for(var o=t.info.cityInfo[0].cityCode,e=t.info.cityInfo,i=1;i<e.length;i++)o+=","+e[i].cityCode;n.goods.cityCode=o}else packaging.fubottom(t.message)})})},copyActivity:function(i){szad.init();var n=this;szad.getUserInfo(function(t){t=actCommon.transformJson(t);var o={advertiseId:parseInt(i),userId:t.garageId,account:t.account},e=actCommon.appApiW()+"/api/app/advertise/sale/advertise/details";szad.requestNetworkData(e,o,function(t){if(packaging.loadingRemove(),(t=actCommon.transformJson(t)).success){n.goods.name=t.info.name,n.goods.content=JSON.parse(t.info.content),n.goods.templateId=t.info.templateId,n.goods.advertiseClassifyId=t.info.advertiseClassifyId,n.goods.posterPic=t.info.posterPic;for(var o=t.info.cityInfo[0].cityCode,e=t.info.cityInfo,i=1;i<e.length;i++){if("000000"==e[i].cityCode||0==e[i].cityCode){o="000000";break}o+=","+e[i].cityCode}n.goods.cityCode=o}else packaging.fubottom(t.message)})})},addGoods:function(){if(this.goods.content.list.length<4){this.goods.content.list.push({goodsImg:"",goodsDescribe:""}),setTimeout(function(){var t=packaging.getScrollHeight();window.scrollTo(0,t)},100)}else $.myAlert("最多只能添加4组")},huanhang:function(t){if(!t)return"";for(var o=(t=t.toString()).split("\n"),e="",i=0;i<o.length;i++)e+="<p>"+o[i]+"</p>";return e},updateImage:function(o){szad.init();var e=this;szad.cutImage({judgeCut:!1},function(t){(t=actCommon.transformJson(t)).success?e.goods.content.list[o].goodsImg=t.info.domain+t.info.filePath:packaging.fubottom(t.message)})},delGoods:function(t){if(1<this.goods.content.list.length){var o=this;$.myConfirmZ({title:"确定要删除吗？",trueBtn:"确定",falseBtn:"我再想想",message:"删除后，您填写的信息将被删除",callback:function(){o.goods.content.list.splice(t,1),packaging.fubottom("删除成功")}})}else packaging.fubottom("至少要保留一组哦~")},preview:function(){this.judge()&&(document.getElementById("goods_footer").style.position="static",this.setInfo("goodList",JSON.stringify(this.goods)),window.location.href="preview1.html")},next:function(){if(this.judge()){this.setInfo("goodList",JSON.stringify(this.goods));var t=packaging.GetQueryString("editid");if(t)return window.location.href="setting.html?editid="+t,!1;var o=packaging.GetQueryString("copy");if(o){var e=this.goods.templateId,i=this.goods.advertiseClassifyId;return window.location.href="setting.html?copy="+o+"&classify="+i+"&plate="+e,!1}i=packaging.GetQueryString("classify"),e=packaging.GetQueryString("plate");i&&e&&(window.location.href="setting.html?classify="+i+"&plate="+e)}},judge:function(){var t=this.goods.content.list;if(!this.goods.name)return $.myAlert("请输入活动名称"),!1;if(this.goods.name.length<2)return $.myAlert("活动标题最少输入2个字"),!1;if(actCommon.isSpecific(this.goods.name))return $.myAlert("活动标题禁止输入特殊符号"),!1;for(var o=0;o<t.length;o++){if(!t[o].goodsImg||!t[o].goodsDescribe)return $.myAlert("请填写完第"+(o+1)+"个商品信息"),!1;if(t[o].goodsDescribe.length<2)return $.myAlert("第"+(o+1)+"个商品的商品描述最少输入2个字以上"),!1;if(actCommon.isSpecific(t[o].goodsDescribe))return $.myAlert("第"+(o+1)+"个商品的商品描述禁止输入特殊字符"),!1}return!0},setInfo:function(t,o){window.sessionStorage.setItem(t,o)},textNumber:function(t){return t?t.length:0},onlyOne:function(t){return!(this.goods.content.list.length<=1)},delImg:function(t){this.goods.content.list[t].goodsImg=""},focusFooter:function(){/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)&&(document.getElementById("goods_footer").style.position="static")},blurFooter:function(){/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)&&(document.getElementById("goods_footer").style.position="fixed")}}})</script><script>!function(){var t=Math.floor(1e6*Math.random()),e=document.createElement("script");e.setAttribute("type","text/javascript"),e.src="../../common/js/tencent.js?rnd="+t;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(e,r)}()</script></body></html>