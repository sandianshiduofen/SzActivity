<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><title>设置活动</title><link rel="stylesheet" href="./css/main.css"><style>[v-cloak]{display:none}</style><script src="./js/szad.js?v=4"></script></head><body style="background:#fff"><section id="temBox" v-cloak><div><div class="guide_hint_w"><div class="guide_hint"><span class="guide_hint_icon"><img src="./images/icon_hint.png" alt=""></span><p class="guide_hint_text">第四步：请设置活动时间<br>别急，就差一步，就成功了！</p><span class="guide_hint_close"><img src="images/icon_close.png" alt=""></span></div></div><div class="edit_set"><div class="flow_path"><div class="flow_path_img"><img src="./images/flow4.png"></div><div class="flow_path_text"><p>类型选择</p><p>选择模板</p><p>活动内容</p><p>活动设置</p></div></div><div class="setting"><div class="unify_border update_goods_img update_goods_img3"><form><label @click="updateCutImage"><img v-if="goods.posterPic" class="update_img_show" :src="goods.posterPic" alt=""><div v-else><h5 class="img_title">点击上传</h5><img class="hand" src="images/hand.png" alt=""><p class="img_con">可上传活动宣传图、商品图、门头照等</p></div></label> <span class="question_mark question_mark2" @click="coverClick"><img src="images/wen1.png"></span></form></div><div class="act_title">活动时间</div><div class="act_time"><div class="unify_border2 w40 setting_time"><input type="text" id="startTimeS" placeholder="请选择开始时间" readonly="readonly" :value="edit.startTime"></div><span class="time_line fl">—</span><div class="unify_border2 w40 setting_time"><input type="text" id="endTimeS" placeholder="请选择结束时间" readonly="readonly" :value="edit.endTime"></div></div><div class="clear"></div><div class="unify_border2" @click="putInClick"><span>投放地区：</span><p v-if="!goods.cityCode.length" class="select_addr">请选择</p><p v-else class="select_addr dian" style="color:#333">{{edit.nationwideS?"全国":edit.checkedAddress}}</p></div><div class="charge_style"><p class="charge_title">收费方式</p><span class="question_mark" @click="chargeClick"><img src="images/wen1.png"></span><p class="charge_have">您现在拥有<span>{{edit.tokenNum}}</span>枚令牌</p></div><div class="submit_audit"><button v-if="edit.tokenNum" @click="submitAudit">提交审核</button> <button v-else @click="goBuyTaken">购买令牌</button></div></div></div><div class="put_in_bg" v-if="edit.charge"><div class="put_in_addr"><div class="charge_style_w"><iframe src="../../doc/token.html?v=1" frameborder="0" scrolling="no" id="external-frame" onload="setIframeHeight(this)"></iframe><button class="put_in_close" @click="chargeClick">关闭</button><div class="charge_style_tel">如有疑问您可致电客服：400-1821-200</div></div></div></div></div><div class="put_in_bg" v-if="edit.cover"><div class="put_in_addr"><h3>展示样例</h3><div class="put_in_img"><img src="images/yang2.jpg?v=3" alt=""></div><ul class="put_in_ul"><li>1、修理厂浏览活动时的封面图</li><li>2、更好的效果图，能够吸引用户点击哦~</li><li>3、如果您没有合适的图片，您可上传门头照或商品图</li></ul><button class="put_in_close" @click="coverClick">关闭</button></div></div><div v-show="edit.putIn" class="fillout_goods_w" @click="putInClick"></div><transition name="slide-fade"><div class="put_in_w" v-show="edit.putIn"><div class="fillout_goods_top"><p>选择投放地区</p><span @click="putInClick"><img src="./images/icon_close.png"></span></div><div class="fillout_goods_h"><div class="put_in_li"><p><label><input type="checkbox" name="cityCodeAll" @change="nationwide" v-model="edit.nationwide"><span>全国<b></b></span></label></p></div><div v-for="list in edit.addressJson"><div class="letter">{{list.initial}}</div><div class="put_in_li"><p v-for="(addr,index) in list.city"><label><input type="checkbox" name="cityCode" :value="addr.cityNumber" v-model="edit.cityCodeShow" :id='"demo"+index' @change="buxuan"><span>{{addr.cityCname}}<b></b></span></label></p></div></div><div class="put_in_footer"><div class="put_in_footer_c"><button class="put_in_btn put_in_btn2" @click="putInClick">取消</button> <button class="put_in_btn" @click="putInTrue">确认</button></div></div></div></div></transition></section><script src="./js/jquery-1.11.3.min.js"></script><script src="./js/alert.js"></script><link rel="stylesheet" href="../../common/js/source/mobiscroll/mobiscroll.css?v=1"><script src="../../common/js/source/mobiscroll/mobiscroll_date.js?v=1" charset="gb2312"></script><script src="../../common/js/source/mobiscroll/mobiscroll.js?v=1"></script><script src="./js/main.js?v=1"></script><script src="../../common/js/source/vue.min.js"></script><script>var app=new Vue({el:"#temBox",data:{goods:{advertiseClassifyId:"",templateId:"",userId:"",account:"",posterPic:"",cityCode:"",startTime:"",endTime:""},edit:{startTime:"",tokenNum:0,maxDays:0,endTime:"",cover:!1,putIn:!1,charge:!1,nationwide:!1,nationwideS:!1,checkedAddress:"",cityCodeShow:null,addressJson:[],addressList:[],imagess:""}},created:function(){szad.init();var i=this;szad.getUserInfo(function(t){t=actCommon.transformJson(t);var e=packaging.GetQueryString("editid");packaging.GetQueryString("copy");e?(delete i.goods.advertiseClassifyId,delete i.goods.templateId,i.goods.advertiseId=e):(i.goods.advertiseClassifyId=parseInt(packaging.GetQueryString("classify")),i.goods.templateId=parseInt(packaging.GetQueryString("plate")),i.goods.cityCode=t.cityNumber),i.goods.userId=t.garageId,i.goods.account=t.account,i.edit.userName=t.username,i.edit.cityNumber=t.cityNumber,i.gainGoods(),i.showTime(),i.address(),i.tokenNum()})},computed:{goodsNumShow:function(){return this.goods.title.length}},methods:{gainGoods:function(){var t=window.sessionStorage;if(t.goodList){var e=JSON.parse(t.goodList);for(var i in e)"string"==typeof e[i]?this.goods[i]=e[i]:this.goods[i]=JSON.stringify(e[i]);var o=packaging.GetQueryString("editid"),a=packaging.GetQueryString("copy");(o||a)&&(this.goods.cityCode&&"000000"!=this.goods.cityCode&&0!=this.goods.cityCode||(this.goods.cityCode="000000",this.edit.nationwideS=!0,this.edit.nationwide=!0))}window.actCommon.addStep("step4",localStorage.step4)},buxuan:function(){for(var t=this.edit.addressList,e=[],i=0;i<t.length;i++)e.push(t[i].cityNumber);e.length==this.edit.cityCodeShow.length?this.edit.nationwide=!0:this.edit.nationwide=!1},coverClick:function(){this.edit.cover?this.edit.cover=!1:(this.timeUpdate(),this.edit.cover=!0)},putInClick:function(){if(this.edit.putIn)this.edit.putIn=!1;else if(this.timeUpdate(),this.edit.putIn=!0,"000000"==this.goods.cityCode){this.edit.nationwide=!0;for(var t=[],e=this.edit.addressJson,i=0;i<e.length;i++)for(var o=0;o<e[i].city.length;o++)t.push(e[i].city[o].cityNumber);this.edit.cityCodeShow=t}else this.edit.nationwide=!1,this.edit.cityCodeShow=this.goods.cityCode.split(",")},timeUpdate:function(){var t=document.getElementById("startTimeS").value,e=document.getElementById("endTimeS").value;this.edit.startTime=t,this.edit.endTime=e},putInTrue:function(){var t=this.edit.cityCodeShow;if(t.length)if(this.edit.nationwide)this.edit.nationwideS=!0,this.goods.cityCode="000000";else{for(var e="",i=0;i<t.length-1;i++)t[i]&&(e+=t[i]+",");e+=t[t.length-1],this.goods.cityCode=e,this.edit.nationwideS=!1,this.cityCodeStr(e)}else this.goods.cityCode="",this.cityCodeStr("");this.edit.cityCodeShow="",this.edit.putIn=!1},chargeClick:function(t){this.edit.charge?this.edit.charge=!1:(this.timeUpdate(),this.edit.charge=!0)},updateCutImage:function(){var e=this;szad.cutImage({judgeCut:!0,width:375,height:160,widthScale:75,heightScale:32},function(t){(t=actCommon.transformJson(t)).success?e.goods.posterPic=t.info.domain+t.info.filePath:packaging.fubottom(t.message)})},showTime:function(){packaging.loading("加载中...");var e=this,t={userId:e.goods.userId},i=actCommon.appApiW()+"/api/app/advertise/sale/advertise/advertiseconfig";szad.requestNetworkData(i,t,function(t){packaging.loadingRemove(),(t=actCommon.transformJson(t)).success?t.info&&(e.edit.maxDays=t.info.maxDays,packaging.GetQueryString("editid")?e.showTimeEdit(t.info.maxDays):e.showTimePush(t.info.maxDays)):packaging.fubottom(t.message)})},showTimePush:function(t){var e=new Date,i=new Date;i.setDate(e.getDate()+parseInt(t)-1),i.setTime(i);var o=e.format("yyyy-MM-dd"),a=i.format("yyyy-MM-dd");this.edit.startTime=o,this.edit.endTime=a},showTimeEdit:function(t){var e=new Date,i=new Date;e.setTime(parseInt(this.goods.startTime)),i.setTime(parseInt(this.goods.endTime));var o=e.format("yyyy-MM-dd"),a=i.format("yyyy-MM-dd");this.edit.startTime=o,this.edit.endTime=a},address:function(){packaging.loading("加载中...");var t={garageId:this.goods.userId,cityNumber:this.edit.cityNumber},e=actCommon.appApiP()+"/api/platform/apphome/findopencity",i=this;szad.requestNetworkData(e,t,function(t){packaging.loadingRemove(),(t=actCommon.transformJson(t)).success?i.addressPush(t.info):packaging.fubottom(t.message)})},addressPush:function(t){for(var e=this.edit.addressList=t,i=[],o=0;o<e.length;o++)i.push(e[o].initial);Array.prototype.unique2=function(){this.sort();for(var t=[this[0]],e=1;e<this.length;e++)this[e]!==t[t.length-1]&&t.push(this[e]);return t},i=i.unique2();var a=[];for(o=0;o<i.length;o++){var s={};s.initial=i[o],s.city=[];for(var n=0;n<e.length;n++)i[o]==e[n].initial&&s.city.push(e[n]);a.push(s)}this.edit.addressJson=a,this.cityCodeStr(this.goods.cityCode)},nationwide:function(){var t=this.edit.addressList,e=[];if(this.edit.nationwide){for(var i=0;i<t.length;i++)e.push(t[i].cityNumber);this.edit.cityCodeShow=e}else this.edit.cityCodeShow=[]},cityCodeStr:function(t){if(t){var e=t.split(","),i=this.edit.addressList,o="";if(i.length)for(var a=0;a<e.length;a++)for(var s=0;s<i.length;s++)e[a]==i[s].cityNumber&&(o+=i[s].cityCname+" ");var n=packaging.GetQueryString("editid"),d=packaging.GetQueryString("copy");n||o||d||(this.goods.cityCode=""),this.edit.checkedAddress=o}else this.edit.checkedAddress=""},tokenNum:function(){packaging.loading("加载中...");var t={userName:this.edit.userName,account:this.goods.account},e=actCommon.appApiW()+"/api/app/advertise/sale/user/num",i=this;szad.requestNetworkData(e,t,function(t){packaging.loadingRemove(),(t=actCommon.transformJson(t)).success?t.info?i.edit.tokenNum=t.info.advNum:i.edit.tokenNum=0:packaging.fubottom(t.message)})},submitAudit:function(){var t=this.goods.posterPic,e=this.edit.startTime,i=this.edit.endTime,o=this.goods.cityCode;if(!t)return packaging.fubottom("请上传活动封面"),!1;if(!e)return packaging.fubottom("开始时间不能为空"),!1;if(!i)return packaging.fubottom("结束时间不能为空"),!1;if(!o)return packaging.fubottom("请选择投放地区"),!1;var a=document.getElementById("startTimeS").value.split("-"),s=document.getElementById("endTimeS").value.split("-"),n=new Date,d=n.getFullYear(),r=n.getMonth()+1,c=n.getDate();if(a[0]==d&&a[1]==r&&a[2]==c){new Date;var g=Date.parse(new Date)}else g=new Date(a[0],a[1]-1,a[2]).getTime();var m=new Date(s[0],s[1]-1,s[2],23,59,59).getTime();if(parseInt(g)>parseInt(m))return packaging.fubottom("开始时间不能大于结束时间"),!1;var h=m-g,u=24*this.edit.maxDays*60*60*1e3;if(parseInt(h)>parseInt(u))return packaging.fubottom("活动时间区间不能大于"+this.edit.maxDays+"天"),!1;if(this.goods.startTime=g.toString(),this.goods.endTime=m.toString(),packaging.loading("提交中..."),packaging.GetQueryString("editid")){p=actCommon.appApiW()+"/api/app/advertise/sale/advertise/update",f=function(t){packaging.loadingRemove(),(t=actCommon.transformJson(t)).success?window.location.href="complete.html?nav=goHome":packaging.fubottom(t.message)};szad.postNetworkData(p,JSON.parse(JSON.stringify(this.goods)),f)}else{var p=actCommon.appApiW()+"/api/app/advertise/sale/advertise/add",f=function(t){packaging.loadingRemove(),(t=actCommon.transformJson(t)).success?window.location.href="complete.html?nav=goHome":packaging.fubottom(t.message)};szad.postNetworkData(p,JSON.parse(JSON.stringify(this.goods)),f)}},goBuyTaken:function(){this.timeUpdate();var e=this;szad.buyTokens(function(t){e.edit.tokenNum=t})}}});function setIframeHeight(t){if(t){var e=t.contentWindow||t.contentDocument.parentWindow;e.document.body&&(t.height=e.document.documentElement.scrollHeight||e.document.body.scrollHeight)}}$(function(){var t=(new Date).getFullYear(),e={date:{preset:"date"},datetime:{preset:"datetime"},time:{preset:"time"}};e.default={theme:"android-ics light",display:"bottom",mode:"scroller",dateFormat:"yy-mm-dd",lang:"zh",showNow:!0,nowText:"今天",startYear:t-50,endYear:t+50,minDate:new Date},$("#startTimeS").mobiscroll($.extend(e.date,e.default)),$("#endTimeS").mobiscroll($.extend(e.date,e.default))})</script><script>!function(){var t=Math.floor(1e6*Math.random()),e=document.createElement("script");e.setAttribute("type","text/javascript"),e.src="../../common/js/tencent.js?rnd="+t;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(e,r)}()</script></body></html>